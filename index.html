<!DOCTYPE html>
<html lang="vi" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="·ª®ng d·ª•ng h·ªçc t·ª´ v·ª±ng ti·∫øng Anh v·ªõi Spaced Repetition System">
    <title>VocabMaster - H·ªçc T·ª´ V·ª±ng Ti·∫øng Anh</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://www.gstatic.com https://cdn.sheetjs.com https://www.google.com https://www.gstatic.com 'unsafe-inline' 'unsafe-eval';
        style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
        font-src 'self' https://fonts.gstatic.com;
        img-src 'self' data: https: blob:;
        connect-src 'self' https://*.googleapis.com https://*.firebaseio.com wss://*.firebaseio.com https://*.cloudfunctions.net https://firestore.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com;
        frame-src https://www.google.com https://vocabmaster-4c784.firebaseapp.com;
    ">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <!-- Loading Overlay - shown until auth state is determined -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <p>ƒêang t·∫£i...</p>
    </div>

    <header class="header">
        <div class="header-left">
            <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="logo">
                <span class="logo-icon">üìö</span>
                <span class="logo-text">VocabMaster</span>
            </div>
        </div>
        <div class="header-right">
            <!-- Login/User Area -->
            <button id="loginBtn" class="btn btn-primary btn-sm" style="padding: 0.5rem 1rem; display: none;">
                ƒêƒÉng nh·∫≠p
            </button>
            <div id="userInfo" class="user-info" style="display: none; cursor: pointer;" onclick="App.showProfileModal()">
                <img id="userAvatar" class="user-avatar" src="" alt="Avatar">
                <span id="userName" class="user-name"></span>
            </div>
            
            <button class="btn-icon" id="syncBtn" aria-label="ƒê·ªìng b·ªô" title="ƒê·ªìng b·ªô d·ªØ li·ªáu">
                ‚òÅÔ∏è
            </button>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                <span class="theme-icon-dark">üåô</span>
                <span class="theme-icon-light">‚òÄÔ∏è</span>
            </button>
        </div>
    </header>

    <!-- Landing Page (shown when not logged in) -->
    <div class="landing-page" id="landingPage">
        <!-- Hero Section -->
        <section class="landing-hero">
            <div class="hero-content">
                <h1 class="hero-title">üìö VocabMaster</h1>
                <p class="hero-subtitle">·ª®ng d·ª•ng h·ªçc t·ª´ v·ª±ng ti·∫øng Anh th√¥ng minh v·ªõi h·ªá th·ªëng Spaced Repetition</p>
                <button class="btn btn-hero btn-lg" id="landingLoginBtn">
                    ƒêƒÉng nh·∫≠p v·ªõi Google ƒë·ªÉ b·∫Øt ƒë·∫ßu
                </button>
            </div>
        </section>

        <!-- Mission & Vision -->
        <section class="landing-section">
            <div class="mission-cards">
                <div class="mission-card">
                    <div class="mission-icon">üéØ</div>
                    <h3>S·ª© m·ªánh</h3>
                    <p>Gi√∫p ng∆∞·ªùi Vi·ªát h·ªçc t·ª´ v·ª±ng ti·∫øng Anh hi·ªáu qu·∫£ v·ªõi ph∆∞∆°ng ph√°p khoa h·ªçc, kh√¥ng nh√†m ch√°n.</p>
                </div>
                <div class="mission-card">
                    <div class="mission-icon">üöÄ</div>
                    <h3>T·∫ßm nh√¨n</h3>
                    <p>Tr·ªü th√†nh ·ª©ng d·ª•ng h·ªçc t·ª´ v·ª±ng #1 Vi·ªát Nam v·ªõi c·ªông ƒë·ªìng h·ªçc t·∫≠p c√πng ti·∫øn.</p>
                </div>
                <div class="mission-card">
                    <div class="mission-icon">üí°</div>
                    <h3>Ph∆∞∆°ng ph√°p</h3>
                    <p>Spaced Repetition System (SRS) - √¥n t·∫≠p ƒë√∫ng l√∫c, nh·ªõ l√¢u h∆°n, ti·∫øt ki·ªám th·ªùi gian.</p>
                </div>
            </div>
        </section>

        <!-- Features -->
        <section class="landing-section">
            <h2 class="section-title">‚ú® T√≠nh nƒÉng n·ªïi b·∫≠t</h2>
            <div class="features-grid">
                <div class="feature-item">
                    <span class="feature-icon">üîä</span>
                    <span>Ph√°t √¢m chu·∫©n US/UK</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üìù</span>
                    <span>Ki·ªÉm tra ch√≠nh t·∫£</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üî•</span>
                    <span>Streak & Gamification</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">‚òÅÔ∏è</span>
                    <span>ƒê·ªìng b·ªô ƒëa thi·∫øt b·ªã</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üèÜ</span>
                    <span>Achievements & Badges</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üìä</span>
                    <span>Th·ªëng k√™ chi ti·∫øt</span>
                </div>
            </div>
        </section>

        <!-- Global Stats -->
        <section class="landing-section">
            <h2 class="section-title">üìä Th·ªëng k√™ c·ªông ƒë·ªìng</h2>
            <div class="global-stats">
                <div class="global-stat">
                    <span class="global-stat-value" id="globalUsers">0</span>
                    <span class="global-stat-label">Ng∆∞·ªùi d√πng</span>
                </div>
                <div class="global-stat">
                    <span class="global-stat-value" id="globalWords">0</span>
                    <span class="global-stat-label">T·ª´ v·ª±ng ƒë√£ h·ªçc</span>
                </div>
                <div class="global-stat">
                    <span class="global-stat-value" id="globalOnline">0</span>
                    <span class="global-stat-label">ƒêang online</span>
                </div>
            </div>
        </section>

        <!-- Leaderboard -->
        <section class="landing-section">
            <h2 class="section-title">üèÜ B·∫£ng x·∫øp h·∫°ng</h2>
            <div class="leaderboard" id="landingLeaderboard">
                <div class="leaderboard-loading">ƒêang t·∫£i...</div>
            </div>
        </section>

        <!-- CTA -->
        <section class="landing-cta">
            <h2>S·∫µn s√†ng b·∫Øt ƒë·∫ßu h√†nh tr√¨nh?</h2>
            <button class="btn btn-hero btn-lg" onclick="Auth.signInWithGoogle()">
                ƒêƒÉng nh·∫≠p ngay
            </button>
        </section>
    </div>

    <!-- App Container (shown when logged in) -->
    <div class="app-container" id="appContainer" style="display: none;">
        <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>Ch·ªß ƒë·ªÅ</h2>
            <button class="btn-icon" id="addTopicBtn" aria-label="Th√™m ch·ªß ƒë·ªÅ">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
            </button>
        </div>
        <nav class="sidebar-nav">
            <button class="nav-item active" data-view="dashboard">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Dashboard</span>
            </button>
            <button class="nav-item" data-view="all-words">
                <span class="nav-icon">üìñ</span>
                <span class="nav-text">T·∫•t c·∫£ t·ª´ v·ª±ng</span>
            </button>
            <button class="nav-item" data-view="review-due">
                <span class="nav-icon">üîî</span>
                <span class="nav-text">C·∫ßn √¥n t·∫≠p</span>
                <span class="nav-badge" id="dueBadge">0</span>
            </button>
            <button class="nav-item" data-view="chat">
                <span class="nav-icon">üí¨</span>
                <span class="nav-text">Chat c·ªông ƒë·ªìng</span>
            </button>
            <button class="nav-item" data-view="inbox">
                <span class="nav-icon">üì¨</span>
                <span class="nav-text">Tin nh·∫Øn</span>
                <span class="nav-badge" id="inboxBadge" style="display: none;">0</span>
            </button>
            <button class="nav-item" data-view="challenges">
                <span class="nav-icon">‚öîÔ∏è</span>
                <span class="nav-text">Th√°ch ƒë·∫•u</span>
            </button>
            <button class="nav-item" data-view="admin" id="adminNavItem" style="display: none;">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">Admin Panel</span>
            </button>
        </nav>
        <div class="sidebar-divider"></div>
        <div class="topics-list" id="topicsList">
            <!-- Topics will be rendered here -->
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Dashboard View -->
        <section class="view active" id="dashboardView">
            <div class="view-header">
                <h1>Dashboard</h1>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-info">
                        <span class="stat-value" id="statTotalWords">0</span>
                        <span class="stat-label">T·ªïng t·ª´ v·ª±ng</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-info">
                        <span class="stat-value" id="statMastered">0</span>
                        <span class="stat-label">ƒê√£ thu·ªôc</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-info">
                        <span class="stat-value" id="statLearning">0</span>
                        <span class="stat-label">ƒêang h·ªçc</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-info">
                        <span class="stat-value" id="statStreak">0</span>
                        <span class="stat-label">Ng√†y li√™n ti·∫øp</span>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-sections">
                <!-- Row 1: Due Words + Weekly Progress -->
                <div class="dashboard-row">
                    <div class="dashboard-section dashboard-section-half">
                        <div class="section-header">
                            <h2>‚ö†Ô∏è T·ª´ c·∫ßn √¥n t·∫≠p h√¥m nay</h2>
                            <button class="btn btn-primary btn-sm" id="startReviewBtn">√în t·∫≠p ngay</button>
                        </div>
                        <div class="due-words-preview" id="dueWordsPreview">
                            <p class="empty-state">Kh√¥ng c√≥ t·ª´ n√†o c·∫ßn √¥n t·∫≠p</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-section dashboard-section-half">
                        <div class="section-header">
                            <h2>üìà Ti·∫øn ƒë·ªô tu·∫ßn n√†y</h2>
                        </div>
                        <div class="weekly-chart" id="weeklyChart">
                            <!-- Chart will be rendered here -->
                        </div>
                    </div>
                </div>
                
                <!-- Row 2: Community Section -->
                <div class="dashboard-row">
                    <div class="dashboard-section dashboard-section-half">
                        <div class="section-header">
                            <h2>üü¢ ƒêang online</h2>
                            <span class="online-count" id="dashboardOnlineCount">0</span>
                        </div>
                        <div class="online-users-preview" id="dashboardOnlineUsers">
                            <p class="empty-state">ƒêang t·∫£i...</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-section dashboard-section-half">
                        <div class="section-header">
                            <h2>üèÜ Top Users</h2>
                        </div>
                        <div class="leaderboard-preview" id="dashboardLeaderboard">
                            <!-- Top 5 users will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Chat View -->
        <section class="view" id="chatView">
            <div class="view-header">
                <h1>üí¨ Chat c·ªông ƒë·ªìng</h1>
                <span class="online-badge"><span class="online-dot"></span> <span id="chatOnlineCount">0</span> ƒëang online</span>
            </div>
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-empty">ƒêang t·∫£i tin nh·∫Øn...</div>
                </div>
                <form class="chat-form" id="chatForm">
                    <input type="text" id="chatInput" placeholder="Nh·∫≠p tin nh·∫Øn..." autocomplete="off" maxlength="500">
                    <button type="submit" class="btn btn-primary">G·ª≠i</button>
                </form>
            </div>
        </section>

        <!-- Admin View -->
        <section class="view" id="adminView">
            <div class="view-header">
                <h1>‚öôÔ∏è Admin Panel</h1>
            </div>
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="users">üë• Users</button>
                <button class="admin-tab" data-tab="messages">üí¨ Messages</button>
            </div>
            <div class="admin-content">
                <!-- Users Tab -->
                <div class="admin-tab-content active" id="adminUsersTab">
                    <div id="adminUsersList">
                        <p class="empty-state">ƒêang t·∫£i...</p>
                    </div>
                </div>
                <!-- Messages Tab -->
                <div class="admin-tab-content" id="adminMessagesTab">
                    <div id="adminMessagesList">
                        <p class="empty-state">ƒêang t·∫£i...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Challenges View -->
        <section class="view" id="challengesView">
            <div class="view-header">
                <h1>‚öîÔ∏è Th√°ch ƒë·∫•u</h1>
                <button class="btn btn-primary" id="createChallengeBtn">
                    <span>+</span> T·∫°o th√°ch ƒë·∫•u
                </button>
            </div>
            <div id="challengesList" class="challenges-list">
                <p class="empty-state">ƒêang t·∫£i...</p>
            </div>
        </section>

        <!-- Inbox View -->
        <section class="view" id="inboxView">
            <div class="view-header">
                <h1>üì¨ Tin nh·∫Øn</h1>
            </div>
            <div id="conversationsList" class="conversations-list">
                <p class="empty-state">ƒêang t·∫£i...</p>
            </div>
        </section>

        <!-- Private Chat View -->
        <section class="view" id="privateChatView">
            <div class="private-chat-header">
                <button class="btn-icon" id="privateChatBack" title="Quay l·∫°i">‚Üê</button>
                <img src="" alt="" class="private-chat-avatar" id="privateChatAvatar">
                <span class="private-chat-name" id="privateChatTitle">Chat</span>
            </div>
            <div class="private-chat-container">
                <div class="private-messages" id="privateMessages">
                    <p class="empty-state">ƒêang t·∫£i...</p>
                </div>
                <form class="private-form" id="privateForm">
                    <input type="text" id="privateInput" placeholder="Nh·∫≠p tin nh·∫Øn..." autocomplete="off" maxlength="500">
                    <button type="submit" class="btn btn-primary">G·ª≠i</button>
                </form>
            </div>
        </section>

        <!-- Topic View -->
        <section class="view" id="topicView">
            <div class="view-header">
                <div class="view-title">
                    <span class="topic-icon" id="topicViewIcon">üìÅ</span>
                    <h1 id="topicViewTitle">Ch·ªß ƒë·ªÅ</h1>
                </div>
                <div class="view-actions">
                    <button class="btn btn-secondary" id="reviewTopicBtn">
                        <span>üìñ</span> √în t·∫≠p
                    </button>
                    <button class="btn btn-secondary" id="testTopicBtn">
                        <span>‚úçÔ∏è</span> Ki·ªÉm tra
                    </button>
                    <button class="btn btn-secondary" id="openImportBtn" onclick="Import.openModal()">
                        <span>üì•</span> Import
                    </button>
                    <button class="btn btn-primary" id="addWordBtn">
                        <span>+</span> Th√™m t·ª´
                    </button>
                </div>
            </div>
            <div class="words-list" id="wordsList">
                <!-- Words will be rendered here -->
            </div>
        </section>

        <!-- All Words View -->
        <section class="view" id="allWordsView">
            <div class="view-header">
                <h1>T·∫•t c·∫£ t·ª´ v·ª±ng</h1>
                <div class="view-actions">
                    <button class="btn btn-secondary" id="reviewAllBtn">
                        <span>üìñ</span> √în t·∫≠p t·∫•t c·∫£
                    </button>
                    <button class="btn btn-secondary" id="testAllBtn">
                        <span>‚úçÔ∏è</span> Ki·ªÉm tra t·∫•t c·∫£
                    </button>
                </div>
            </div>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm t·ª´ v·ª±ng...">
            </div>
            <div class="words-list" id="allWordsList">
                <!-- All words will be rendered here -->
            </div>
        </section>

        <!-- Review Due View -->
        <section class="view" id="reviewDueView">
            <div class="view-header">
                <h1>üîî T·ª´ c·∫ßn √¥n t·∫≠p</h1>
                <div class="view-actions">
                    <button class="btn btn-primary" id="startDueReviewBtn">B·∫Øt ƒë·∫ßu √¥n t·∫≠p</button>
                </div>
            </div>
            <div class="words-list" id="dueWordsList">
                <!-- Due words will be rendered here -->
            </div>
        </section>

        <!-- Review Mode -->
        <section class="view" id="reviewView">
            <div class="review-container">
                <div class="review-progress">
                    <span id="reviewProgress">0 / 0</span>
                    <button class="btn-icon" id="closeReviewBtn" aria-label="ƒê√≥ng">‚úï</button>
                </div>
                <div class="flashcard" id="flashcard">
                    <div class="flashcard-inner">
                        <div class="flashcard-front">
                            <button class="speak-btn" id="speakBtn" aria-label="Ph√°t √¢m">üîä</button>
                            <p class="flashcard-word" id="flashcardWord">Word</p>
                        </div>
                        <div class="flashcard-back">
                            <p class="flashcard-meaning" id="flashcardMeaning">Nghƒ©a</p>
                        </div>
                    </div>
                </div>
                <p class="flashcard-hint">Click ƒë·ªÉ l·∫≠t th·∫ª</p>
                <div class="review-actions">
                    <button class="btn btn-secondary" id="prevCardBtn">‚Üê Tr∆∞·ªõc</button>
                    <button class="btn btn-primary" id="nextCardBtn">Ti·∫øp ‚Üí</button>
                </div>
            </div>
        </section>

        <!-- Test Mode -->
        <section class="view" id="testView">
            <div class="test-container">
                <div class="test-progress">
                    <span id="testProgress">0 / 0</span>
                    <span id="testScore">ƒê√∫ng: 0</span>
                    <button class="btn-icon" id="closeTestBtn" aria-label="ƒê√≥ng">‚úï</button>
                </div>
                <div class="test-card">
                    <p class="test-meaning" id="testMeaning">Nghƒ©a ti·∫øng Vi·ªát</p>
                    <input type="text" class="test-input" id="testInput" placeholder="Nh·∫≠p t·ª´ ti·∫øng Anh..." autocomplete="off">
                    <div class="test-feedback" id="testFeedback"></div>
                </div>
                <div class="test-actions">
                    <button class="btn btn-secondary" id="skipWordBtn">B·ªè qua</button>
                    <button class="btn btn-primary" id="checkAnswerBtn">Ki·ªÉm tra</button>
                </div>
            </div>
        </section>

        <!-- Test Result -->
        <section class="view" id="testResultView">
            <div class="result-container">
                <div class="result-icon">üéâ</div>
                <h1>K·∫øt qu·∫£ ki·ªÉm tra</h1>
                <div class="result-stats">
                    <div class="result-stat">
                        <span class="result-value" id="resultCorrect">0</span>
                        <span class="result-label">ƒê√∫ng</span>
                    </div>
                    <div class="result-stat">
                        <span class="result-value" id="resultWrong">0</span>
                        <span class="result-label">Sai</span>
                    </div>
                    <div class="result-stat">
                        <span class="result-value" id="resultAccuracy">0%</span>
                        <span class="result-label">T·ª∑ l·ªá</span>
                    </div>
                </div>
                <div class="wrong-words" id="wrongWordsList">
                    <!-- Wrong words will be shown here -->
                </div>
                <button class="btn btn-primary" id="backToDashboardBtn">V·ªÅ Dashboard</button>
            </div>
        </section>
    </main>

    <!-- Modal: Add/Edit Topic -->
    <div class="modal" id="topicModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="topicModalTitle">Th√™m ch·ªß ƒë·ªÅ</h2>
                <button class="btn-icon modal-close" aria-label="ƒê√≥ng">‚úï</button>
            </div>
            <form id="topicForm">
                <div class="form-group">
                    <label for="topicName">T√™n ch·ªß ƒë·ªÅ</label>
                    <input type="text" id="topicName" required placeholder="VD: ƒê·ªông v·∫≠t, Th·ª©c ƒÉn...">
                </div>
                <div class="form-group">
                    <label>Ch·ªçn icon</label>
                    <div class="icon-picker" id="iconPicker">
                        <button type="button" class="icon-option selected" data-icon="üìÅ">üìÅ</button>
                        <button type="button" class="icon-option" data-icon="üìö">üìö</button>
                        <button type="button" class="icon-option" data-icon="üéì">üéì</button>
                        <button type="button" class="icon-option" data-icon="üíº">üíº</button>
                        <button type="button" class="icon-option" data-icon="üè†">üè†</button>
                        <button type="button" class="icon-option" data-icon="üçî">üçî</button>
                        <button type="button" class="icon-option" data-icon="üê∂">üê∂</button>
                        <button type="button" class="icon-option" data-icon="‚úàÔ∏è">‚úàÔ∏è</button>
                        <button type="button" class="icon-option" data-icon="üéµ">üéµ</button>
                        <button type="button" class="icon-option" data-icon="‚öΩ">‚öΩ</button>
                        <button type="button" class="icon-option" data-icon="üåç">üåç</button>
                        <button type="button" class="icon-option" data-icon="üíª">üíª</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Ch·ªçn m√†u</label>
                    <div class="color-picker" id="colorPicker">
                        <button type="button" class="color-option selected" data-color="#FF6B6B" style="background:#FF6B6B"></button>
                        <button type="button" class="color-option" data-color="#4ECDC4" style="background:#4ECDC4"></button>
                        <button type="button" class="color-option" data-color="#45B7D1" style="background:#45B7D1"></button>
                        <button type="button" class="color-option" data-color="#96CEB4" style="background:#96CEB4"></button>
                        <button type="button" class="color-option" data-color="#FFEAA7" style="background:#FFEAA7"></button>
                        <button type="button" class="color-option" data-color="#DDA0DD" style="background:#DDA0DD"></button>
                        <button type="button" class="color-option" data-color="#98D8C8" style="background:#98D8C8"></button>
                        <button type="button" class="color-option" data-color="#F7DC6F" style="background:#F7DC6F"></button>
                    </div>
                </div>
                <input type="hidden" id="topicId">
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary modal-close">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Create Challenge -->
    <div class="modal" id="challengeModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öîÔ∏è T·∫°o th√°ch ƒë·∫•u</h2>
                <button class="btn-icon modal-close" aria-label="ƒê√≥ng">‚úï</button>
            </div>
            <div class="form-group">
                <label>Ch·ªçn ƒë·ªëi th·ªß (click ƒë·ªÉ ch·ªçn)</label>
                <div id="challengeOpponentList" class="opponent-list">
                    <!-- Users will be populated with avatars -->
                </div>
            </div>
            <div class="form-group">
                <label>Ch·ªçn Topic</label>
                <select id="challengeTopicSelect" class="form-select">
                    <!-- Topics will be populated -->
                </select>
            </div>
            <div class="form-group">
                <label>S·ªë t·ª´</label>
                <input type="number" id="challengeWordCount" class="form-input" value="10" min="5" max="50">
            </div>
            <input type="hidden" id="challengeOpponentId">
            <div class="form-actions">
                <button type="button" class="btn btn-secondary modal-close">H·ªßy</button>
                <button type="button" class="btn btn-primary" id="sendChallengeBtn">G·ª≠i th√°ch ƒë·∫•u</button>
            </div>
        </div>
    </div>

    <!-- Modal: Import CSV -->
    <div class="modal" id="importModal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üì• Import t·ª´ v·ª±ng</h2>
                <button class="btn-icon modal-close" aria-label="ƒê√≥ng">‚úï</button>
            </div>
            <div class="form-group">
                <label>Ch·ªçn file CSV ho·∫∑c Excel</label>
                <input type="file" id="importFile" accept=".csv,.txt,.xlsx,.xls" class="file-input">
                <p class="form-hint">Format: c·ªôt 1 = English, c·ªôt 2 = Vietnamese</p>
            </div>
            <div class="form-group">
                <label>Import v√†o Topic</label>
                <select id="importTopicSelect" class="form-select">
                    <!-- Topics will be populated -->
                </select>
            </div>
            <div class="import-preview-container">
                <div class="import-preview-header">
                    <span>Xem tr∆∞·ªõc (<span id="importCount">0</span> t·ª´)</span>
                </div>
                <div id="importPreview" class="import-preview">
                    <p class="empty-state">Ch·ªçn file CSV ƒë·ªÉ xem tr∆∞·ªõc</p>
                </div>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary modal-close">H·ªßy</button>
                <button type="button" class="btn btn-primary" id="executeImportBtn" disabled>Import</button>
            </div>
        </div>
    </div>

    <!-- Modal: Add/Edit Word -->
    <div class="modal" id="wordModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="wordModalTitle">Th√™m t·ª´ v·ª±ng</h2>
                <button class="btn-icon modal-close" aria-label="ƒê√≥ng">‚úï</button>
            </div>
            <form id="wordForm">
                <div class="form-group">
                    <label for="wordEnglish">Ti·∫øng Anh</label>
                    <input type="text" id="wordEnglish" required placeholder="VD: apple">
                </div>
                <div class="form-group">
                    <label for="wordVietnamese">Ti·∫øng Vi·ªát</label>
                    <input type="text" id="wordVietnamese" required placeholder="VD: qu·∫£ t√°o">
                </div>
                <input type="hidden" id="wordId">
                <input type="hidden" id="wordTopicId">
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary modal-close">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Test/Review Config -->
    <div class="modal" id="configModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="configModalTitle">C·∫•u h√¨nh</h2>
                <button class="btn-icon modal-close" aria-label="ƒê√≥ng">‚úï</button>
            </div>
            <form id="configForm">
                <div class="form-group">
                    <label>Ph·∫°m vi</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="scope" value="topic" checked>
                            <span>Ch·ªß ƒë·ªÅ hi·ªán t·∫°i</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="scope" value="all">
                            <span>T·∫•t c·∫£ t·ª´ v·ª±ng</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label>S·ªë l∆∞·ª£ng t·ª´</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="count" value="all" checked>
                            <span>T·∫•t c·∫£ (<span id="totalWordsCount">0</span> t·ª´)</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="count" value="random">
                            <span>Random:</span>
                            <input type="number" id="randomCount" min="1" value="10" class="inline-input">
                            <span>t·ª´</span>
                        </label>
                    </div>
                </div>
                <input type="hidden" id="configMode">
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary modal-close">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">B·∫Øt ƒë·∫ßu</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Edit User (Admin) -->
    <div class="modal" id="editUserModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>S·ª≠a User</h2>
                <button class="btn-icon modal-close" aria-label="ƒê√≥ng">‚úï</button>
            </div>
            <form id="editUserForm">
                <div class="form-group">
                    <label>T√™n hi·ªÉn th·ªã</label>
                    <input type="text" id="editUserName" required>
                </div>
                <div class="form-group">
                    <label>XP</label>
                    <input type="number" id="editUserXP" min="0">
                </div>
                <div class="form-group">
                    <label>Streak (ng√†y)</label>
                    <input type="number" id="editUserStreak" min="0">
                </div>
                <div class="form-group">
                    <label>Freeze c√≤n l·∫°i</label>
                    <input type="number" id="editUserFreeze" min="0">
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="editUserAdmin">
                        <span>L√† Admin</span>
                    </label>
                </div>
                <div class="form-group">
                    <label>üíé Premium Badges (c·∫•p cho user)</label>
                    <div class="premium-badges-checkboxes">
                        <label class="checkbox-label">
                            <input type="checkbox" id="editBadgeVerified">
                            <span>‚úÖ Verified</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="editBadgeDiamond">
                            <span>üíé Diamond</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="editBadgeFlame">
                            <span>üî• Flame</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="editBadgeRainbow">
                            <span>üåà Rainbow</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="editBadgeUnique">
                            <span>üé≠ Unique</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="editBadgeVip">
                            <span>üëë VIP</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="editBadgeCreator">
                            <span>üì∑ Creator</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="editBadgeDeveloper">
                            <span>üíª Developer</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="editBadgeSupporter">
                            <span>‚ù§Ô∏è Supporter</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="editBadgeChampion">
                            <span>üèÖ Champion</span>
                        </label>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary modal-close">H·ªßy</button>
                    <button type="submit" class="btn btn-primary">L∆∞u</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: View User Profile -->
    <div class="modal" id="viewUserModal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Th√¥ng tin ng∆∞·ªùi d√πng</h2>
                <button class="btn-icon modal-close" aria-label="ƒê√≥ng">‚úï</button>
            </div>
            <div class="view-user-content">
                <div class="view-user-header">
                    <img src="" alt="" class="view-user-avatar" id="viewUserAvatar">
                    <div class="view-user-name" id="viewUserName">Name</div>
                </div>
                <div class="view-user-stats">
                    <div class="view-user-stat">
                        <span class="stat-value" id="viewUserXP">0</span>
                        <span class="stat-label">XP</span>
                    </div>
                    <div class="view-user-stat">
                        <span class="stat-value" id="viewUserStreak">0</span>
                        <span class="stat-label">üî• Streak</span>
                    </div>
                    <div class="view-user-stat">
                        <span class="stat-value" id="viewUserWords">0</span>
                        <span class="stat-label">T·ª´ v·ª±ng</span>
                    </div>
                    <div class="view-user-stat">
                        <span class="stat-value" id="viewUserMastered">0</span>
                        <span class="stat-label">ƒê√£ thu·ªôc</span>
                    </div>
                </div>
                <div class="view-user-actions" id="viewUserActions">
                    <button class="btn btn-secondary" id="viewUserMessageBtn">üí¨ Nh·∫Øn tin</button>
                    <button class="btn btn-primary" id="viewUserChallengeBtn">‚öîÔ∏è Th√°ch ƒë·∫•u</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: User Data (Admin) -->
    <div class="modal" id="userDataModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="userDataTitle">User Data</h2>
                <button class="btn-icon modal-close" aria-label="ƒê√≥ng">‚úï</button>
            </div>
            <div id="userDataContent" class="user-data-container">
                <!-- User topics and words will be rendered here -->
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary modal-close">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- Modal: Confirm Delete -->
    <div class="modal" id="confirmModal">
        <div class="modal-overlay"></div>
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>X√°c nh·∫≠n x√≥a</h2>
                <button class="btn-icon modal-close" aria-label="ƒê√≥ng">‚úï</button>
            </div>
            <p id="confirmMessage">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a?</p>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary modal-close">H·ªßy</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">X√≥a</button>
            </div>
        </div>
    </div>

    <!-- Modal: User Profile -->
    <div class="modal" id="profileModal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>T√†i kho·∫£n</h2>
                <button class="btn-icon modal-close" aria-label="ƒê√≥ng">‚úï</button>
            </div>
            <div class="profile-content">
                <!-- User Info -->
                <div class="profile-user">
                    <img id="profileAvatar" class="profile-avatar" src="" alt="Avatar">
                    <div class="profile-details">
                        <div class="profile-name-row">
                            <h3 id="profileName">Ng∆∞·ªùi d√πng</h3>
                            <button class="edit-name-btn" onclick="App.editDisplayName()">‚úèÔ∏è</button>
                        </div>
                        <p id="profileEmail">email@example.com</p>
                    </div>
                </div>
                
                <!-- Stats -->
                <div class="profile-stats">
                    <div class="profile-stat">
                        <span class="profile-stat-value" id="profileTotalWords">0</span>
                        <span class="profile-stat-label">T·ªïng t·ª´</span>
                    </div>
                    <div class="profile-stat">
                        <span class="profile-stat-value" id="profileMastered">0</span>
                        <span class="profile-stat-label">ƒê√£ thu·ªôc</span>
                    </div>
                    <div class="profile-stat">
                        <span class="profile-stat-value" id="profileStreak">0</span>
                        <span class="profile-stat-label">Chu·ªói ng√†y</span>
                    </div>
                    <div class="profile-stat">
                        <span class="profile-stat-value" id="profileFreezes">‚ùÑÔ∏è3</span>
                        <span class="profile-stat-label">Freeze</span>
                    </div>
                </div>
                
                <!-- Level Progress -->
                <div class="profile-level">
                    <div class="level-header">
                        <span id="profileLevel">C·∫•p 1: Ng∆∞·ªùi h·ªçc m·ªõi</span>
                        <span id="profileXP">0 XP</span>
                    </div>
                    <div class="level-bar">
                        <div class="level-fill" id="profileLevelFill" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Animated Badge -->
                <div class="profile-section">
                    <h4>üè∑Ô∏è Badge Hi·ªáu ·ª®ng</h4>
                    <div class="animated-badge-section" id="profileAnimatedBadge">
                        <!-- Badge will be rendered here by JS -->
                    </div>
                </div>
                
                <!-- Badges -->
                <div class="profile-section">
                    <h4>üèÖ Huy ch∆∞∆°ng</h4>
                    <div class="badges-grid" id="profileBadges">
                        <!-- Badges will be rendered here -->
                    </div>
                </div>
                
                <!-- Theme Colors -->
                <div class="profile-section">
                    <h4>üé® M√†u ch·ªß ƒë·ªÅ</h4>
                    <div class="theme-colors" id="themeColors">
                        <button class="color-option active" data-color="" title="Indigo">
                            <span style="background: #6366f1"></span>
                        </button>
                        <button class="color-option" data-color="emerald" title="Emerald">
                            <span style="background: #10b981"></span>
                        </button>
                        <button class="color-option" data-color="rose" title="Rose">
                            <span style="background: #f43f5e"></span>
                        </button>
                        <button class="color-option" data-color="amber" title="Amber">
                            <span style="background: #f59e0b"></span>
                        </button>
                        <button class="color-option" data-color="cyan" title="Cyan">
                            <span style="background: #06b6d4"></span>
                        </button>
                    </div>
                </div>
                
                <!-- History Summary -->
                <div class="profile-section">
                    <h4>üìä Th·ªëng k√™ s·ª≠ d·ª•ng</h4>
                    <ul class="profile-history">
                        <li>Ng√†y tham gia: <span id="profileJoinDate">--</span></li>
                        <li>T·ªïng b√†i ki·ªÉm tra: <span id="profileTestCount">0</span></li>
                        <li>ƒê·ªô ch√≠nh x√°c: <span id="profileAccuracy">0%</span></li>
                    </ul>
                </div>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary modal-close">ƒê√≥ng</button>
                <button type="button" class="btn btn-danger" id="profileLogoutBtn">üö™ ƒêƒÉng xu·∫•t</button>
        </div>
    </div>

    <!-- Close App Container -->
    </div>

    <!-- Toast Notification -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="js/storage.js"></script>
    <script src="js/firebase.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/security.js"></script>
    <script src="js/srs.js"></script>
    <script src="js/speech.js"></script>
    <script src="js/stats.js"></script>
    <script src="js/topics.js"></script>
    <script src="js/vocabulary.js"></script>
    <script src="js/review.js"></script>
    <script src="js/test.js"></script>
    <script src="js/badges.js"></script>
    <script src="js/achievements.js"></script>
    <script src="js/leaderboard.js"></script>
    <script src="js/chat.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/import.js"></script>
    <script src="js/privateChat.js"></script>
    <script src="js/challenges.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
